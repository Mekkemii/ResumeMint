/**
 * Строгий API-промпт для оценки резюме
 * Используется с Structured Outputs для гарантированного формата ответа
 */

const systemPrompt = `Ты — эксперт по резюме, ATS-системам и IT-грейдам.

Твоя задача — проанализировать резюме и вернуть строго структурированную оценку в JSON формате.

КРИТЕРИИ ОЦЕНКИ:

1. ГРЕЙД (Junior/Middle/Senior/Lead):
   - Junior (0-2 года): базовые навыки, выполнение задач под контролем
   - Middle (2-5 лет): уверенная работа, оптимизация решений
   - Senior (5-8 лет): проектирование архитектуры, сложные задачи
   - Lead (8+ лет): руководство командами, стратегические решения

2. ОЦЕНКИ (0-100):
   - text: качество текста, ясность, грамотность
   - structure: структура документа, логичность
   - overall: общая оценка (среднее из text и structure)

3. ATS-СОВМЕСТИМОСТЬ (0-100):
   - Соответствие ключевым словам
   - Форматирование для автоматических систем

ВАЖНО:
- Анализируй ТОЛЬКО факты из текста
- Если опыт не найден, пиши "в тексте не найдено описание опыта"
- Не придумывай информацию
- Все оценки должны быть обоснованными

Возвращай ТОЛЬКО валидный JSON по схеме.`;

const userPrompt = (resumeText, evidence) => {
  const hhInstructions = `
ВАЖНО: Это резюме кандидата (возможны маркеры [EXPERIENCE]...[/EXPERIENCE] вокруг блоков опыта):
- Определи блоки опыта: 'Опыт работы/Карьера/Проекты/Практика/Фриланс/Консалтинг'
- Если видишь маркеры [EXPERIENCE]...[/EXPERIENCE], считай эти части опытом
- Заголовок 'Специализации' — это не опыт
- Даты вида 'ММ.ГГГГ — н.в.' интерпретируй как период работы
- Ищи опыт в нестандартных форматах: проекты, кейсы, фриланс, стажировки

`;

  const evidenceInfo = evidence?.found
    ? `\nНайденные признаки опыта: ${evidence.lines.join(", ")}\n`
    : `\nВ тексте не найдено явного описания опыта\n`;

  return `${hhInstructions}ЗАДАЧА:
1) Определи грейд кандидата и обоснуй
2) Оцени качество текста (0-100)
3) Оцени структуру резюме (0-100)
4) Вычисли общую оценку
5) Оцени ATS-совместимость (0-100)
6) Укажи сильные стороны (максимум 7)
7) Укажи недостатки (максимум 7)
8) Дай рекомендации по улучшению (максимум 7)
9) Сформулируй уточняющие вопросы (максимум 6)

РЕЗЮМЕ:
${resumeText}${evidenceInfo}

Верни строго структурированную оценку в JSON формате.`;
};

module.exports = { systemPrompt, userPrompt };
